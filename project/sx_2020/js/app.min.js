if (top.location.href != window.location.href) {
    top.location.href = window.location.href
}(function () {
    window.app = {
        defaultPID: 1,
        defaultWishPID: 1001,
        defaultQingFuPID: 2001,
        defaultTarotPID: 3001,
        defaultAstrolabePID: 4001,
        defaultAnimalsPID: 6001,
        baseURL: window.location.protocol + "//" + window.location.host,
        isEmojiCharacter: function (k) {
            for (var j = 0; j < k.length; j++) {
                var h = k.charCodeAt(j);
                if (55296 <= h && h <= 56319) {
                    if (k.length > 1) {
                        var f = k.charCodeAt(j + 1);
                        var g = ((h - 55296) * 1024) + (f - 56320) + 65536;
                        if (118784 <= g && g <= 128895) {
                            return true
                        }
                    }
                } else {
                    if (k.length > 1) {
                        var f = k.charCodeAt(j + 1);
                        if (f == 8419) {
                            return true
                        }
                    } else {
                        if (8448 <= h && h <= 10239) {
                            return true
                        } else {
                            if (11013 <= h && h <= 11015) {
                                return true
                            } else {
                                if (10548 <= h && h <= 10549) {
                                    return true
                                } else {
                                    if (12951 <= h && h <= 12953) {
                                        return true
                                    } else {
                                        if (h == 169 || h == 174 || h == 12349 || h == 12336 || h == 11093 ||
                                            h == 11036 || h == 11035 || h == 11088) {
                                            return true
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        formatTime: function (f, i) {
            var h = new Date(i);
            var j = {
                "M+": h.getMonth() + 1,
                "d+": h.getDate(),
                "h+": h.getHours(),
                "m+": h.getMinutes(),
                "s+": h.getSeconds(),
                "q+": Math.floor((h.getMonth() + 3) / 3),
                S: h.getMilliseconds()
            };
            if (/(y+)/.test(f)) {
                f = f.replace(RegExp.$1, (h.getFullYear() + "").substr(4 - RegExp.$1.length))
            }
            for (var g in j) {
                if (new RegExp("(" + g + ")").test(f)) {
                    f = f.replace(RegExp.$1, (RegExp.$1.length == 1) ? (j[g]) : (("00" + j[g]).substr(("" +
                        j[g]).length)))
                }
            }
            return f
        },
        formatCurrency: function (g) {
            var f = g % 100;
            var j = "." + (f < 10 ? "0" : "") + f;
            if (f == 0) {
                j = ""
            }
            g = g / 100;
            g = g.toString().replace(/\$|\,/g, "");
            if (isNaN(g)) {
                g = "0"
            }
            sign = (g == (g = Math.abs(g)));
            g = Math.floor(g * 100 + 0.50000000001);
            g = Math.floor(g / 100).toString();
            for (var h = 0; h < Math.floor((g.length - (1 + h)) / 3); h++) {
                g = g.substring(0, g.length - (4 * h + 3)) + "," + g.substring(g.length - (4 * h + 3))
            }
            return (((sign) ? "" : "-") + g) + j
        },
        funcUrlDel: function (j) {
            var h = window.location;
            var l = h.origin + h.pathname + "?";
            var m = h.search.substr(1);
            if (m.indexOf(j) > -1) {
                var n = {};
                var f = m.split("&");
                for (var k = 0; k < f.length; k++) {
                    f[k] = f[k].split("=");
                    n[f[k][0]] = f[k][1]
                }
                delete n[j];
                var g = l + JSON.stringify(n).replace(/[\"\{\}]/g, "").replace(/\:/g, "=").replace(/\,/g,
                    "&");
                return g
            }
        },
        nownow: (navigator.userAgent.toLowerCase().match(/now/gi) || [""])[0],
        version: (function () {
            if (!(navigator.userAgent.toLowerCase().match(/now/gi) || [""])[0]) {
                return 0
            }
            var g = navigator.userAgent.toLowerCase().split("/");
            var h = g[g.length - 2];
            var f = h.split(".");
            return parseInt(f.join(""))
        })(),
        random: function (g, f) {
            return Math.random() * (f - g) + g
        },
        getUa: (function () {
            var i = navigator.userAgent.toLowerCase();
            var k = i.match(/ipad/i) == "ipad";
            var m = i.match(/iphone os/i) == "iphone os";
            var f = i.match(/android/i) == "android";
            var n = i.match(/micromessenger/i) == "micromessenger";
            var j = i.match(/weibo/i) == "weibo";
            var g = i.match(/qq/i) == "qq";
            var h = i.match(/ios-coco/i) == "ios-coco";
            var o = i.match(/android-coco/i) == "android-coco";
            var l = window.__wxjs_environment == "miniprogram";
            return {
                isMiniProgram: l,
                ipad: k,
                iphone: m,
                android: f,
                weibo: j,
                weixin: n,
                qq: g,
                ios: m || k,
                iosCoco: h,
                androidCoco: o,
                coco: h || o
            }
        })(),
        query: function (g, f) {
            var i = new RegExp("(^|\\?|&)" + g + "=([^&^#]*)(\\s|&|#|$)", "i");
            f = f || location.href;
            if (i.test(f)) {
                var h = decodeURIComponent(RegExp.$2.replace(/\+/g, " "));
                return h.replace(/\??10000skip=true/gi, "")
            }
            return ""
        },
        isWXChannel: function (f) {
            var g = [3, 13, 1005, 1008, 1009, 2003, 2006, 2009, 2013, 3005, 3008, 4003, 4006];
            return (g.indexOf(f) == -1)
        },
        isXianlaiChannel: function () {
            var f = [1009, 2009, 3008, 4006];
            return f.indexOf(parseInt(app.query("p"))) != -1
        },
        XLH5SDKPath: "https://download.xianlaivip.com/h5gamesdk/xlh5sdk-0.0.8.js",
        formatXLDiamondNum: function (f) {
            function g(h, i) {
                return Math.floor(h * Math.pow(10, i)) / Math.pow(10, i)
            }
            if (f > 100000000) {
                return g(f / 100000000, 2) + "亿"
            } else {
                if (f > 10000) {
                    return g(f / 10000, 2) + "万"
                }
            }
            return f
        },
        addNavBar: function () {
            $(".mod-page").before(
                '                <div class="nav-bar">                    <div class="nav-left"><img src="/imgs/nav_back.png"></div>                    <h1></h1>                    <div class="nav-right">返回大厅</div>                </div>'
            );
            $(".nav-bar h1").text($("title").text());
            $("body").css("padding-top", 44);
            app.require(app.XLH5SDKPath, function () {
                $(".nav-left").on("click", function () {
                    history.back()
                });
                $(".nav-right").on("click", function () {
                    XLH5SDK.closeWebView()
                })
            })
        },
        setNavBarTitle: function (f) {
            $("title").text(f);
            $(".nav-bar h1").text(f)
        },
        _hm: function () {
            window._hmt = window._hmt || [];
            var f = document.createElement("script");
            switch (window.location.hostname) {
                case "m.putaoputao.cn":
                    f.src = "//hm.baidu.com/hm.js?d45e72c64de3950acfc6283146f8e46a";
                    break;
                case "wxt.putaoputao.cn":
                    f.src = "//hm.baidu.com/hm.js?26afb22090c28dc716543c6005ca646e";
                    break;
                case "vp1.putaoputao.cn":
                    f.src = "//hm.baidu.com/hm.js?71b25cdcccee7bfdcbee0a9686e8c5d3";
                    break
            }
            document.getElementsByTagName("head")[0].appendChild(f)
        },
        template: function (q, g, j, f, l) {
            f = f || {
                autoProtocol: false
            };
            f.index = f.index || 0;
            if (c(q) === "undefined" || c(g) === "undefined") {
                return ""
            }
            var h = [];
            j = j || {};
            if (c(g) === "array") {
                for (var k = 0, m = g.length; k < m; k++) {
                    f.index = k;
                    h.push(app.template(q, g[k], j, f))
                }
            } else {
                var p;
                if ({
                        "[object string]": 1,
                        "[object number]": 1,
                        "[object boolean]": 1
                    } [Object.prototype.toString.call(g).toLowerCase()]) {
                    p = {
                        index: f.index + 1,
                        item: g
                    }
                }
                var n = {};
                b(g, n);
                a(n, j);
                h.push(q.replace(/\{\$([^}]*)\}/g, function (t, o) {
                    var r = n,
                        s = p || g;
                    for (var u = 0, v = o.split("."); u < v.length; u++) {
                        r = r ? r[v[u]] : null;
                        s = s ? s[v[u]] : null
                    }
                    if (f.autoProtocol) {
                        return c(r) === "function" ? r(app.toProtocol(s), p || g, n, f.index) :
                            (app.toProtocol(app.returnNumOrStr(s)) || app.toProtocol(app.returnNumOrStr(
                                r)) || "")
                    }
                    return c(r) === "function" ? r(s, p || g, n, f.index) : (app.returnNumOrStr(
                        s) || app.returnNumOrStr(r) || "")
                }))
            }
            return h.join("")
        },
        returnNumOrStr: function (f) {
            return Object.prototype.toString.call(f).toLowerCase() === "[object number]" ? ("" + f) : f
        },
        toProtocol: function (h, g) {
            if (Object.prototype.toString.call(h).toLowerCase() !== "[object string]") {
                return h
            }
            var f = h.split("://");
            if (f.length >= 2) {
                if (f[0] == g) {
                    return h
                }
                if (g) {
                    return [g, f[1]].join("://")
                } else {
                    var i = window.location.protocol;
                    i = i.substr(0, i.length - 1);
                    return [i, f[1]].join("://")
                }
            } else {
                return f
            }
        },
        connectWebViewJavascriptBridge: function (f) {
            if (window.WebViewJavascriptBridge) {
                f(window.WebViewJavascriptBridge)
            } else {
                document.addEventListener("WebViewJavascriptBridgeReady", function () {
                    f(window.WebViewJavascriptBridge)
                }, false);
                if (app.getUa.ios) {
                    if (window.WVJBCallbacks) {
                        window.WVJBCallbacks.push(f)
                    } else {
                        window.WVJBCallbacks = [f]
                    }
                }
            }
        },
        parseUrl: function (g, k) {
            if (g) {
                k = k || {};
                if (g.indexOf("?") >= 0) {
                    var m = g.split("?")[1].split("&");
                    var f = null;
                    for (var j = 0; j < m.length; j++) {
                        f = m[j].split("=");
                        try {
                            k[f[0]] = decodeURIComponent(f[1])
                        } catch (l) {
                            k[f[0]] = f[1]
                        }
                    }
                }
                g = g.split("?")[0];
                var h = $.param(k);
                if (h) {
                    g = g + "?" + h
                }
            }
            g = g || location.href;
            g = $.trim(g);
            if (g.indexOf("http") < 0) {
                g = app.baseURL + g
            }
            return g
        },
        needToken: function (k, f, h) {
            k = k || function () {};
            f = app.parseUrl(f, h);
            var j = f.replace(app.baseURL, "");
            if (app.nownow) {
                app.connectWebViewJavascriptBridge(function (l) {
                    l.callHandler("signature", {
                        url: f
                    }, function (m) {
                        k(m, f)
                    })
                })
            } else {
                if (app.getUa.isMiniProgram) {
                    var g = app.query("key");
                    var i = app.query("sessionID");
                    app.getToken(j, g, i, function (l) {
                        k(l, f)
                    })
                } else {
                    k({}, f)
                }
            }
        },
        checkLogin: function (f) {
            if (app.nownow) {
                return app.connectWebViewJavascriptBridge(function (g) {
                    g.callHandler("signature", {
                        url: location.href
                    }, function (h) {
                        app.isLogin = !!h["x-nownow-http-key"];
                        f && f()
                    })
                })
            }
            app.isLogin = !!app.GetCookie("now_now");
            f && f()
        },
        getToken: function (f, j, m, n) {
            var l = new Date().getTime();
            var k = l * 1000;
            var g = l + "+" + k;
            var i = f + "+" + g;
            var h = j;
            app.calculateHMAC(i, m, function (o) {
                var p = {
                    "x-nownow-http-key": h,
                    "x-ts-header": g,
                    "x-req-sig": o
                };
                n && n(p)
            })
        },
        require: function (f, j) {
            var i = document;
            var g = i.head || (i.getElementsByTagName("head")[0] || i.documentElement);
            var h = i.createElement("script");
            h.onload = j;
            h.onerror = function () {};
            h.async = true;
            h.src = f;
            g.appendChild(h)
        },
        calculateHMAC: function (g, f, h) {
            app.require("/js/lib/crypto-js.js", function () {
                var i = CryptoJS.HmacSHA1(g, f).toString(CryptoJS.enc.Base64);
                console.log("data " + g);
                console.log("key " + f);
                console.log("sign " + i);
                h && h(i)
            })
        },
        needLogin: function (j, f, h, g) {
            g = g || "";
            j = j || function () {};
            f = app.parseUrl(f, h);
            var i = f.replace(app.baseURL, "");
            if (g && g.indexOf("http") < 0) {
                g = $.trim(g);
                g = app.baseURL + g
            }
            if (app.GetCookie("now_now")) {
                j({}, f)
            } else {
                if (app.getUa.weixin) {
                    window.location.href = app.baseURL + "/weixin/mp/login.do?redURL=" + encodeURIComponent(
                        g || window.location.href)
                } else {
                    j({}, f)
                }
            }
        },
        registForApp: function (f, g) {
            if (app.nownow) {
                app.connectWebViewJavascriptBridge(function (h) {
                    h.registerHandler(f, g)
                })
            } else {
                window[f] = g
            }
        },
        setCookie: function (h, j, f, m, i, l) {
            var g = new Date();
            g.setTime(g.getTime());
            if (f) {
                f = f * 1000 * 60 * 60 * 24
            }
            var k = new Date(g.getTime() + (f));
            document.cookie = h + "=" + encodeURIComponent(j) + ((f) ? ";expires=" + k.toGMTString() : "") +
                ((m) ? ";path=" + m : "") + ((i) ? ";domain=" + i : "") + ((l) ? ";secure" : "")
        },
        deleteCookie: function (f, h, g) {
            if (this.GetCookie(f)) {
                document.cookie = f + "=" + ((h) ? ";path=" + h : "") + ((g) ? ";domain=" + g : "") +
                    ";expires=Thu, 01-Jan-1970 00:00:01 GMT"
            }
        },
        GetCookie: function (f) {
            var k = null;
            if (document.cookie && document.cookie != "") {
                var j = document.cookie.split(";");
                for (var h = 0; h < j.length; h++) {
                    var g = j[h].replace(/^\s+|\s+$/g, "");
                    if (g.substring(0, f.length + 1) == (f + "=")) {
                        k = decodeURIComponent(g.substring(f.length + 1));
                        break
                    }
                }
            }
            return k
        },
        wxmsgOnly: function (f) {
            f.hideOptionMenu();
            f.showMenuItems({
                menuList: ["menuItem:share:timeline"]
            })
        },
        weixinJSInit: function () {
            app.weixinStatus = true;
            app.weixin()
        },
        weixin: function (f) {
            if (!app.getUa.weixin) {
                return
            }
            if (!f && app.weixinData) {
                wx.showOptionMenu();
                wxProtocol.init(app.weixinData)
            } else {
                app.weixinData = f;
                if (app.weixinStatus) {
                    wx.showOptionMenu();
                    wxProtocol.init(app.weixinData);
                    app.weixinData = null
                }
            }
        },
        setAppFn: function (f, g) {
            g = g || function () {};
            app.registForApp(f, g)
        },
        getWN: function (f) {
            var g = JSON.parse(window.name);
            return g[f] || ""
        },
        setWN: function (f, h) {
            var g = JSON.parse(window.name);
            g[f] = h;
            window.name = JSON.stringify(g)
        },
        noScrollTop: 0,
        noScroll: function () {
            app.noScrollTop = $(window).scrollTop();
            app.noScrollTop == 0 && app.noScrollTop++;
            $("html").css("overflow", "hidden");
            $(window).scrollTop(app.noScrollTop);
            $(window).on("touchmove.appe", e)
        },
        scroll: function () {
            $("html").css("overflow", "");
            $(window).scrollTop(app.noScrollTop);
            $(window).off(".appe")
        },
        browser: function (g) {
            if (g.length == 0) {
                return
            }
            var f = g;
            if (f.indexOf("http") < 0) {
                f = app.baseURL + f
            }
            if (app.nownow) {
                return app.connectWebViewJavascriptBridge(function (h) {
                    h.callHandler("browser", {
                        url: f
                    }, function (i) {})
                })
            }
            window.location.href = f
        },
        needReload: function () {
            if (app.GetCookie("needReload")) {
                return false
            }
            app.setCookie("needReload", window.location.href, 0, "/")
        },
        hideShare: function () {
            if (app.nownow) {
                app.connectWebViewJavascriptBridge(function (f) {
                    f.callHandler("rightBarStyle", {
                        style: ""
                    }, function (g) {})
                })
            } else {
                app.weixin(function (g, f) {
                    g.hideOptionMenu()
                })
            }
        },
        setShareAll: function (f) {
            if (app.nownow) {
                app.connectWebViewJavascriptBridge(function (g) {
                    g.callHandler("rightBarStyle", {
                        style: "share"
                    }, function (h) {})
                });
                app.connectWebViewJavascriptBridge(function (g) {
                    g.callHandler("setShareData", {
                        desc: f.desc,
                        imgUrl: f.picUrl,
                        link: f.linkUrl,
                        title: f.title,
                        circle: f.circle || f.title
                    }, function (h) {})
                })
            } else {
                app.weixin(function (h, g) {
                    h.showOptionMenu();
                    h.onMenuShareAppMessage({
                        title: f.title,
                        desc: f.desc,
                        link: f.linkUrl,
                        imgUrl: f.picUrl,
                        success: function () {
                            updateShareStatus()
                        }
                    });
                    h.onMenuShareTimeline({
                        title: f.circle || f.title,
                        link: f.linkUrl,
                        imgUrl: f.picUrl,
                        success: function () {
                            updateShareStatus()
                        }
                    })
                })
            }
        },
        close: function (f) {
            f = f || false;
            if (app.nownow) {
                app.connectWebViewJavascriptBridge(function (g) {
                    g.callHandler("closeWebview", {
                        all: f
                    }, function (h) {})
                })
            } else {
                if (app.getUa.weixin) {
                    app.weixin(function (g) {
                        g.closeWindow()
                    })
                } else {
                    window.close()
                }
            }
        },
        shouldHandleXianlaiOldApp: function () {
            return window.screen.availWidth > window.screen.availHeight
        },
        xianlaiMaxWidth: 375,
        needHandleXianlaiOldApp: function () {
            if (app.shouldHandleXianlaiOldApp()) {
                $(".mod-page").css({
                    "max-width": app.xianlaiMaxWidth + "px",
                    margin: "0 auto"
                });
                $(".nav-bar").remove();
                $("body").css("padding-top", 0);
                $(".mod-page").append(
                    '<div class="xl-back-btn">返回</div><div class="xl-home-btn">游戏大厅</div>');
                app.require(app.XLH5SDKPath, function () {
                    $(".xl-back-btn").on("click", function () {
                        history.back()
                    });
                    $(".xl-home-btn").on("click", function () {
                        XLH5SDK.closeWebView()
                    })
                })
            }
        }
    };
    (function () {
        try {
            var h = false;
            var f = true;
            var g = 0;
            $(document).on("touchstart.global", "[data-url]", function () {
                if (h) {
                    f = false
                } else {
                    f = true
                }
            }).on("tap", "[data-url]", function () {
                if (!f) {
                    return false
                }
                var m = $(this);
                var j = m.data("url");
                var k = m.data("hmtparam") || "";
                if (k) {
                    k = k.split(",");
                    k.unshift("_trackEvent");
                    try {
                        _hmt.push(k)
                    } catch (l) {}
                }
                if (j.indexOf("http") < 0) {
                    j = app.baseURL + j
                }
                if (app.nownow) {
                    return app.connectWebViewJavascriptBridge(function (n) {
                        n.callHandler("browser", {
                            url: j
                        }, function (o) {})
                    })
                }
                window.location.href = j
            }).on("touchend.global", "[data-url]", function (j) {
                j.stopPropagation();
                j.preventDefault()
            });
            $(window).on("scroll.global", function () {
                clearTimeout(g);
                h = true;
                g = setTimeout(function () {
                    h = false
                }, 100)
            })
        } catch (i) {}
    })();

    function b(h, g) {
        for (var f in h) {
            if (typeof f === "undefined") {
                continue
            }
            if (typeof h[f] == "object") {
                g[f] = {};
                if (h[f] instanceof Array) {
                    g[f] = []
                }
                b(h[f], g[f]);
                continue
            }
            g[f] = h[f]
        }
    }

    function a(h, g, l) {
        if (l) {
            a(h, l)
        }
        if (h && g && typeof g === "object") {
            var k, f;
            for (k in g) {
                h[k] = g[k]
            }
        }
        return h
    }

    function c(f) {
        return /^\[object (.*)\]$/.exec(Object.prototype.toString.call(f).toLowerCase())[1]
    }

    function e(f) {
        if (f.target.tagName.toLowerCase() == "a") {
            return
        }
        if (f && f.preventDefault) {
            f.preventDefault()
        } else {
            window.event.returnValue = false
        }
        return false
    }
    if (app.query("forcelogin") == 1 && app.getUa.weixin) {
        setTimeout(app.needLogin, 1000)
    }(function () {
        var g = window.location.pathname;
        if (g == "/qiuqian/map.html" || g == "/qiuqian/yuelao.html") {
            return
        }
        if (app.getUa.weixin) {
            return f("/js/share/jweixin-1.0.0.js", function () {
                f("/js/share/weixin_1.0.min.js", function () {
                    app.weixinJSInit()
                })
            })
        }
        var h = null;
        if (app.nownow) {
            h = document.createElement("iframe");
            h.style.display = "none";
            h.src = "wvjbscheme://__BRIDGE_LOADED__";
            document.documentElement.appendChild(h);
            setTimeout(function () {
                document.documentElement.removeChild(h)
            }, 1000)
        }

        function f(i, m) {
            var l = document;
            var j = l.head || (l.getElementsByTagName("head")[0] || l.documentElement);
            var k = l.createElement("script");
            k.onload = m;
            k.onerror = function () {};
            k.async = true;
            k.src = i;
            j.appendChild(k)
        }
    })();
    app.registForApp("shareCallback", function () {});
    app.checkLogin();
    if (app.isXianlaiChannel()) {
        app.addNavBar();
        app.needHandleXianlaiOldApp()
    }
    if (app.query("fxp") == 1) {
        $(".mod-page").after(
            '<div class="fx-toolbar">                <div class="btn card">生成专属邀请卡</div>                <!-- <div class="btn tip">攻略</div> -->            </div>'
        );
        $(".mod-page").css("padding-bottom", "50px");
        $(".fx-toolbar .card").on("click", function () {
            window.location.href = "/mng/sale/invite_user.html?u=" + encodeURIComponent(window.location.href)
        })
    }
    var d = app.query("s");
    if (d) {
        app.needLogin(function (g, f) {
            $.ajax({
                url: f,
                headers: g,
                data: {
                    saleID: d
                }
            })
        }, "/fx/createSaleUser.do")
    }
    typeof $ !== "undefined" ? $(app._hm) : app._hm();
    (function () {
        if (window.DeviceMotionEvent) {
            window.addEventListener("devicemotion", f, false)
        } else {
            f()
        }

        function f() {
            var g = app.GetCookie("needReload");
            if (g && g != window.location.href) {
                app.setCookie("needReload", "1", "-1", "/");
                setTimeout(function () {
                    window.location.reload(true)
                }, 100)
            }
        }
    })();
    (function () {
        if (typeof WeixinJSBridge == "object" && typeof WeixinJSBridge.invoke == "function") {
            f()
        } else {
            if (document.addEventListener) {
                document.addEventListener("WeixinJSBridgeReady", f, false)
            } else {
                if (document.attachEvent) {
                    document.attachEvent("WeixinJSBridgeReady", f);
                    document.attachEvent("onWeixinJSBridgeReady", f)
                }
            }
        }

        function f() {
            WeixinJSBridge.invoke("setFontSizeCallback", {
                fontSize: 0
            });
            WeixinJSBridge.on("menu:setfont", function () {
                WeixinJSBridge.invoke("setFontSizeCallback", {
                    fontSize: 0
                })
            })
        }
    })()
})();